<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Annotate the Bible</title>


    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,400italic|Lora:400,400italic|Bitter:400,400italic|Quattrocento|Open+Sans:400,400italic' rel='stylesheet' type='text/css'>

    <!-- Uncomment for Greek font support 
    <link href='https://fonts.googleapis.com/css?family=Lato:400,400italic|Lora:400,400italic|Bitter:400,400italic|Quattrocento|Open+Sans:400,400italic&subset=latin,greek,greek-ext' rel='stylesheet' type='text/css'> 
    -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
    body {
      font-family: 'Open Sans', Helvetica, Verdana, Arial, sans-serif;
      font-size: 2em;
    }

     #major p#text {
      font-size: 2em;
     }

     #major {
      z-index: 4;
      background-image: url(/graph-bg.png);
     }

     #annotations {
      z-index: 16;
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height: 100%;
     }
    </style>
  </head>
  <body>


    <div class="container-fluid">

      <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3">
              <h1 class="text-center">Annotate</h1>
          </div>
      </div>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3">
            <p class="text-center">
              I want to annotate 
                <select name="book" id="book" title="select a chapter">
                  <option value="Matthew">Matthew</option>
                  <option value="Mark">Mark</option>
                  <option value="Luke">Luke</option>
                  <option value="John">John</option>
                </select>
              
                <select name="chapter" id="chapter" title="select a chapter">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                </select>
              :
                <select name="verse" id="verse" title="select one or more verses">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                </select>

              in the 
              
                <select name="translation" id="translation">
                  <option value="NET">NET</option>
                </select>

                <!-- [TODO: add multiple verses] -->
              </p>
          </div>
        </div>



      <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3" id="major">
              <p id="text">
              For God so loved the world that he gave his only son that whoever believes in him will have eternal life.
              </p><!-- 
              <canvas id="annotations" style="border:1px solid #000000;">
              </canvas> -->
          </div>
      </div>

      <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3" id="major">
            <div id="canvasDiv"></div>
          </div>
      </div>



      <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3">
          <h3>Settings</h3>
          </div>
      </div>
      <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3">
          Change the font to 
                <select name="font" id="font" title="select a font">
                  <option>Roboto Slab</option>
                  <option>Lora</option>
                  <option>Lato</option>
                  <option>Quattrocento</option>
                  <option>Bitter</option>
                  <option>Arvo</option>
                </select>
                 please.
          </div>
      </div>
      <div class="row">
          <div class="col-sm-12 col-md-6 col-md-offset-3">
          <input type="checkbox" name="touch" value="1"> Enable Touch
          </div>
      </div>

    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <script src="/js/html5-canvas-drawing-app.js"></script>

    <script>

$(document).ready(function() {

  var verse = {
    book: 'John',
    chapter: '3',
    verse: '16',
    transalation: 'NET'
  };

  $('#book').change(function() {
    verse.book = $(this).val();
    updateVerse();
  });
  $('#chapter').change(function() {
    verse.chapter = $(this).val();
    updateVerse();
  });
  $('#verse').change(function() {
    verse.verse = $(this).val();
    updateVerse();
  });
  $('#translation').change(function() {
    verse.translation = $(this).val();
    updateVerse();
  });

  var updateVerse = function() {

    var endpoint;
    var payload = {};

    if (verse.translation === 'NET') {
      //E.g: 'http://labs.bible.org/api/?passage=John%203:16';
      endpoint = 'http://labs.bible.org/api/?passage=' + verse.book + '%20' + verse.chapter + ':' +verse.verse + '&type=json&formatting=full';
    } else {
      //TODO
    }

    $.get(endpoint, payload, function(data) {
      console.log(data);
      $('#text').html(data[0].text);
    }, 'json');

  };

});

//Enable drawing on a HTML5 canvas object.
var drawify = function (canvas)
{

  var myCanvas = $(canvas);
  var painting = false;
  var clickX = [];
  var clickY = [];
  var clickDrag = [];

  if (!myCanvas.is('canvas')) {
    throw 'drawify only works on HTML5 Canvas elements.';
  }

  var context = myCanvas[0].getContext('2d');

  //Wire up Canvas to Click events
  this.disableTouch = function() {
    console.log('Touch disabled');
    myCanvas.mousedown(drawStart);
    myCanvas.mousemove(drawGo);
    myCanvas.mouseup(drawEnd);

    myCanvas.unbind( "touchstart");
    myCanvas.unbind( "touchend");
  };
  // //Wire up Canvas to Touch events
  // this.enableTouch = function() {
  //   console.log('Touch enabled');
  //   myCanvas.bind( "touchstart", drawStart);
  //   myCanvas.bind( "touchend", drawEnd);

  //   myCanvas.unbind('mousedown');
  //   myCanvas.unbind('mousemove');
  //   myCanvas.unbind('mouseup');
  // };
  //Default: enable touch.
  this.disableTouch();

  //Define 
  var drawStart = function(e) {
    console.log('start drawing');
    var mouseX = e.pageX - this.offsetLeft;
    var mouseY = e.pageY - this.offsetTop;
      
    painting = true;
    addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop);
    redraw();

  };

  var drawGo = function(e) {
    if(painting){
      addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop, true);
      redraw();
    }
  };

  var drawEnd = function() {
    console.log('stop drawing');
    painting = false;
  };

  var addClick = function(x, y, dragging)
  {
    clickX.push(x);
    clickY.push(y);
    clickDrag.push(dragging);
  }

  //Make more efficient.
  var redraw = function(){
    context.clearRect(0, 0, context.canvas.width, context.canvas.height); // Clears the canvas
    
    context.strokeStyle = "#df4b26";
    context.lineJoin = "round";
    context.lineWidth = 5;
        
    for(var i=0; i < clickX.length; i++) {    
      context.beginPath();
      if(clickDrag[i] && i){
        context.moveTo(clickX[i-1], clickY[i-1]);
       }else{
         context.moveTo(clickX[i]-1, clickY[i]);
       }
       context.lineTo(clickX[i], clickY[i]);
       context.closePath();
       context.stroke();
    }
  };
  
  return this;

};
    </script>

  </body>
</html>